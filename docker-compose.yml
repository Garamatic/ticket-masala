# ═══════════════════════════════════════════════════════════════════════════
# Ticket Masala Core Engine
# ═══════════════════════════════════════════════════════════════════════════
#
# Runs the core engine with the default template tenant.
# To run specific tenants, use the docker-compose.yml in their respective repos
# or mount their directories.
#
# Usage:
#   docker compose up
# ═══════════════════════════════════════════════════════════════════════════

services:
  # ════════════════════════════════════════════════════════════
  # CORE ENGINE (Template Tenant)
  # ════════════════════════════════════════════════════════════
  core:
    image: ticket-masala:latest
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    container_name: ticket_masala_core

    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M

    ports:
      - "8080:8080"

    volumes:
      # THE BRAIN: Injecting tenant config (Read Only)
      - ./tenants/_template/config:/app/inputs/config:ro
      # THE MEMORY: Persisting the DB (Read Write)
      - ./tenants/_template/data:/app/inputs/data:rw
      # THE STYLE: Injecting tenant theme (Read Only)
      - ./tenants/_template/theme:/app/wwwroot/tenant-theme:ro

    environment:
      - ConnectionStrings__DefaultConnection=Data Source=/app/inputs/data/masala.db;Cache=Shared;Mode=ReadWriteCreate
      - MasalaConfig__ConfigPath=/app/inputs/config
      - ASPNETCORE_ENVIRONMENT=Production
      - MASALA_CONFIG_PATH=/app/inputs/config
      - MASALA_DB_PATH=/app/inputs/data/masala.db

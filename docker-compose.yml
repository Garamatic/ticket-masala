services:
  ticket-masala:
    image: ticket-masala:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ticket_masala_engine
    restart: unless-stopped

    # LIMITS: We are "Lite", so we prove it.
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M

    ports:
      - "8080:8080"

    volumes:
      # THE BRAIN: Injecting the rules (Read Only)
      - ./config:/app/config:ro

      # THE MEMORY: Persisting the DB (Read Write)
      - ./data:/app/data:rw

    environment:
      # SQLite connection string
      - ConnectionStrings__DefaultConnection=Data Source=/app/data/masala.db;Cache=Shared;Mode=ReadWriteCreate

      # Config path for YAML files
      - MasalaConfig__ConfigPath=/app/config

      # Environment
      - ASPNETCORE_ENVIRONMENT=Production

      # Override default paths if needed
      - MASALA_CONFIG_PATH=/app/config
      - MASALA_DB_PATH=/app/data/masala.db

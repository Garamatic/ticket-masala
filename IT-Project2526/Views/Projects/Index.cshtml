@model List<IT_Project2526.ViewModels.ProjectTicketViewModel>
@using IT_Project2526.Models
@{
    ViewData["Title"] = "Projects";
    ViewData["Description"] = "Manage and view all your projects";
}

<!-- Page Header -->
<div class="page-header">
    <div>
        <h1 class="page-title">
            <i class="fas fa-folder-open text-primary me-2"></i>
            Projects
        </h1>
        <p class="text-secondary mb-0">Manage your projects and track progress</p>
    </div>
    <div class="page-actions">
        <a asp-controller="Projects" asp-action="NewProject" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>
            Create New Project
        </a>
    </div>
</div>

<!-- Filters and Search -->
<div class="filters-bar">
    <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="form-control" id="projectSearch" placeholder="Search projects by name..." />
    </div>
    
    <select class="form-control" id="statusFilter" style="max-width: 200px;">
        <option value="">All Status</option>
        <option value="0">Pending</option>
        <option value="1">In Progress</option>
        <option value="2">Completed</option>
        <option value="3">Failed</option>
    </select>
    
    <button class="btn btn-outline-primary">
        <i class="fas fa-filter me-2"></i>
        More Filters
    </button>
</div>

@if (Model != null && Model.Any())
{
    <!-- Project Statistics -->
    <div class="stats-grid mb-4">
        <div class="stat-card">
            <div class="stat-card-title">Total Projects</div>
            <div class="stat-card-value">@Model.Count</div>
            <div class="stat-card-change">
                <i class="fas fa-arrow-up me-1"></i> Active
            </div>
        </div>
        
        <div class="stat-card secondary">
            <div class="stat-card-title">In Progress</div>
            <div class="stat-card-value">@Model.Count(p => p.ProjectDetails.Status == Status.InProgress)</div>
            <div class="stat-card-change">Being worked on</div>
        </div>
        
        <div class="stat-card success">
            <div class="stat-card-title">Completed</div>
            <div class="stat-card-value">@Model.Count(p => p.ProjectDetails.Status == Status.Completed)</div>
            <div class="stat-card-change">Successfully finished</div>
        </div>
        
        <div class="stat-card warning">
            <div class="stat-card-title">Pending</div>
            <div class="stat-card-value">@Model.Count(p => p.ProjectDetails.Status == Status.Pending)</div>
            <div class="stat-card-change">Awaiting start</div>
        </div>
    </div>

    <!-- Projects Grid -->
    <div class="project-grid" id="projectsGrid">
        @foreach (var item in Model)
        {
            var statusClass = item.ProjectDetails.Status switch
            {
                Status.Pending => "pending",
                Status.InProgress => "in-progress",
                Status.Completed => "completed",
                Status.Failed => "failed",
                _ => "pending"
            };
            
            var statusBadgeClass = item.ProjectDetails.Status switch
            {
                Status.Pending => "badge-pending",
                Status.InProgress => "badge-in-progress",
                Status.Completed => "badge-completed",
                Status.Failed => "badge-danger",
                _ => "badge-primary"
            };

            <div class="project-card fade-in" data-status="@((int)item.ProjectDetails.Status)" data-name="@item.ProjectDetails.Name.ToLower()">
                <div class="project-card-header">
                    <div>
                        <h3 class="project-title">@item.ProjectDetails.Name</h3>
                        <span class="badge @statusBadgeClass">
                            @item.ProjectDetails.Status.ToString()
                        </span>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" onclick="window.location='@Url.Action("Details", "Projects", new { id = item.ProjectDetails.Guid })'">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <p class="project-description">
                    @(item.ProjectDetails.Description?.Length > 120 
                        ? item.ProjectDetails.Description.Substring(0, 120) + "..." 
                        : item.ProjectDetails.Description ?? "No description available")
                </p>

                <div class="project-meta">
                    <div class="project-meta-item">
                        <i class="fas fa-user text-primary"></i>
                        <span>@(item.ProjectDetails.ProjectManager?.Name ?? "Unassigned")</span>
                    </div>
                    
                    <div class="project-meta-item">
                        <i class="fas fa-ticket-alt text-secondary"></i>
                        <span>@(item.Tasks?.Count ?? 0) Tickets</span>
                    </div>
                </div>

                @if (item.Tasks != null && item.Tasks.Any())
                {
                    <div class="project-stats mt-3 pt-3 border-top">
                        <div class="project-stat">
                            <div class="project-stat-value">@item.Tasks.Count(t => t.Status == "Completed")</div>
                            <div class="project-stat-label">
                                <i class="fas fa-check-circle text-success"></i> Done
                            </div>
                        </div>
                        <div class="project-stat">
                            <div class="project-stat-value">@item.Tasks.Count(t => t.Status == "InProgress")</div>
                            <div class="project-stat-label">
                                <i class="fas fa-spinner text-info"></i> Active
                            </div>
                        </div>
                        <div class="project-stat">
                            <div class="project-stat-value">@item.Tasks.Count(t => t.Status == "Pending")</div>
                            <div class="project-stat-label">
                                <i class="fas fa-clock text-warning"></i> Pending
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
}
else
{
    <!-- Empty State -->
    <div class="empty-state">
        <div class="empty-state-icon">
            <i class="fas fa-folder-open"></i>
        </div>
        <h3 class="empty-state-title">No Projects Yet</h3>
        <p class="empty-state-description">
            Get started by creating your first project. Click the button below to begin.
        </p>
        <a asp-controller="Projects" asp-action="NewProject" class="btn btn-primary btn-lg">
            <i class="fas fa-plus me-2"></i>
            Create Your First Project
        </a>
    </div>
}

@section Scripts {
    <script>
        // Project Search
        document.getElementById('projectSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const projects = document.querySelectorAll('.project-card');
            
            projects.forEach(project => {
                const projectName = project.dataset.name;
                if (projectName.includes(searchTerm)) {
                    project.style.display = 'block';
                } else {
                    project.style.display = 'none';
                }
            });
        });

        // Status Filter
        document.getElementById('statusFilter').addEventListener('change', function(e) {
            const selectedStatus = e.target.value;
            const projects = document.querySelectorAll('.project-card');
            
            projects.forEach(project => {
                if (selectedStatus === '' || project.dataset.status === selectedStatus) {
                    project.style.display = 'block';
                } else {
                    project.style.display = 'none';
                }
            });
        });
    </script>
}